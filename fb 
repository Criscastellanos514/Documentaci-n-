USE control_inventario_ti;
GO

SELECT state_id, state_name
FROM dbo.states
ORDER BY state_name;

SELECT TOP 1 entity_id
FROM dbo.entities
WHERE entity_name = 'Request Approval';

SELECT TOP 1 state_id
FROM dbo.states
WHERE state_name = 'Pendiente';

SELECT TOP 1 state_entity_id
FROM dbo.state_entities;


SELECT *
FROM request_approvals
WHERE request_id = (
    SELECT request_id
    FROM requests
    WHERE request_name = 'Prueba_worker_001'
);


SELECT 
  ra.request_approval_id,
  ra.request_id,
  ra.user_id,
  ra.state_entity_id,
  s.state_name,
  e.entity_name,
  ra.request_approval_type,
  ra.create_at,
  ra.modify_at
FROM dbo.request_approvals ra
JOIN dbo.state_entities se ON se.state_entity_id = ra.state_entity_id
JOIN dbo.states s ON s.state_id = se.state_id
JOIN dbo.entities e ON e.entity_id = se.entity_id
WHERE ra.request_id = (
  SELECT request_id
  FROM dbo.requests
  WHERE request_name = 'Prueba_worker_001'
);