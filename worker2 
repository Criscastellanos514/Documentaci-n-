dotnet add package Microsoft.Extensions.Hosting
dotnet add package Microsoft.Extensions.Configuration.Json
dotnet add package Microsoft.Extensions.Http
dotnet add package Microsoft.Data.SqlClient
dotnet add package Dapper

{
  "ConnectionStrings": {
    "Default": "Server=localhost;Database=ApprovalDB;User Id=sa;Password=YourPassword123;TrustServerCertificate=True;"
  },
  "Worker": {
    "IntervalSeconds": 30,
    "DryRun": false,
    "BatchSize": 10
  },
  "Broker": {
    "Url": "http://localhost:5050",
    "Topic": "request_approval"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.Hosting.Lifetime": "Information"
    }
  }
}


namespace ApprovalWorker.Messaging;

public class ApprovalMessage
{
    public Guid RequestId { get; set; }
    public string Description { get; set; } = string.Empty;
    public string Name { get; set; } = string.Empty;
    public Guid UserId { get; set; }
    public DateTime Timestamp { get; set; }
}



namespace ApprovalWorker.Messaging;

public interface IMessageBroker
{
    Task SubscribeAsync(string topic, Func<ApprovalMessage, Task> handler, CancellationToken cancellationToken);
    Task PublishAsync(string topic, ApprovalMessage message, CancellationToken cancellationToken);
}


